import{r as e,j as a,Y as s,a as i}from"./app-0nnjcZrn.js";import{F as r,a as t}from"./filter-sidebar-Diy1sZlT.js";import{I as l,a as n}from"./index-YOVMUvqp.js";import{u as o}from"./use-toast-Dj50PcGS.js";import"./iconBase-x5fZwo94.js";const d=({products:d,categories:c,favorites:m=[]})=>{const[u,h]=e.useState({minPrice:"",maxPrice:""}),[x,v]=e.useState([]),[p,f]=e.useState([]),[g,j]=e.useState([]),[N,S]=e.useState([]),[b,w]=e.useState(m.map(e=>e.id)),{toast:y}=o(),C=null==d?void 0:d.filter(e=>{var a;if(!e.variants||0===e.variants.length)return!1;if(!e.variants.some(e=>{const a=Number(e.price);return!(u.minPrice&&a<Number(u.minPrice))&&!(u.maxPrice&&a>Number(u.maxPrice))}))return!1;if(x.length>0){if(!e.variants.some(e=>{var a;return null==(a=e.sizes)?void 0:a.some(e=>x.includes(e))}))return!1}if(p.length>0){if(!e.variants.some(e=>{var a;return null==(a=e.colors)?void 0:a.some(e=>p.includes(e))}))return!1}return!(g.length>0&&!g.includes(e.brend))&&!(N.length>0&&!N.includes(null==(a=e.category)?void 0:a.name))});e.useEffect(()=>{m&&m.length>0&&w(m.map(e=>e.id))},[m]);const P=Array.from(new Set((null==d?void 0:d.flatMap(e=>e.variants.flatMap(e=>e.colors||[])))||[])),z=Array.from(new Set((null==d?void 0:d.flatMap(e=>e.variants.flatMap(e=>e.sizes||[])))||[])),M=Array.from(new Set(null==d?void 0:d.map(e=>e.brend).filter(Boolean)));return Array.from(new Set(null==d?void 0:d.map(e=>{var a;return null==(a=e.category)?void 0:a.name}).filter(Boolean))),a.jsxs("div",{className:"px-5 xl:px-20 mt-20",children:[a.jsx("h2",{className:"text-2xl font-oswald",children:"Mahsulotlar"}),a.jsx(r,{onPriceChange:h,onSizeChange:v,onColorChange:f,sizes:z,colors:P,brands:M,categories:c}),a.jsxs("div",{className:"grid xl:grid-cols-4 xl:gap-5 w-full",children:[a.jsx("div",{className:"hidden xl:block px-3",children:a.jsx(t,{colors:P,sizes:z,brands:M,categories:c,variantsColors:P,variantsSizes:z,onPriceChange:h,onSizeChange:v,onColorChange:f,onBrandChange:j,onCategoryChange:S,onClearFilters:()=>{h({minPrice:"",maxPrice:""}),v([]),f([]),j([]),S([])}})}),a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 xl:col-span-3 xl:h-2/5 gap-3",children:null==C?void 0:C.map(e=>{const r=Math.min(...e.variants.map(e=>e.price));return a.jsxs(s,{href:`/detail/${e.id}`,className:"rounded relative","aria-label":`View details for ${e.product_name}`,children:[a.jsx("div",{className:"flex justify-end rounded-t-lg",children:a.jsx("img",{src:`/storage/${e.photo1}?v=${Date.now()}`,loading:"lazy",alt:e.product_name,className:"w-full overflow-hidden object-cover h-56 rounded"})}),a.jsxs("div",{className:"flex items-end justify-between ",children:[a.jsxs("div",{className:" overflow-hidden rounded-t-lg p-2",children:[a.jsx("p",{className:"text-2xl font-semibold",children:e.product_name}),a.jsxs("p",{className:"text-lg",children:[r.toLocaleString()," ",a.jsx("span",{className:"text-sm text-slate-500",children:"so'm"})]}),a.jsx("p",{className:"text-sm text-slate-500",children:e.variants.map((s,i)=>{var r;return a.jsxs("span",{children:[null==(r=s.sizes)?void 0:r.join(", "),i<e.variants.length-1?", ":""]},s.id)})})]}),a.jsx("button",{onClick:a=>(async(e,a)=>{if(e.preventDefault(),b.includes(a))try{await i.delete(`/favorites/${a}`),w(e=>e.filter(e=>e!==a)),y({title:"Sevimlilardan o'chirildi",description:"✅ Mahsulot olib tashlandi"})}catch(s){console.error(s),y({title:"Xatolik",description:"❌ Sevimlilardan o‘chirishda muammo"})}else try{await i.post("/favorites",{product_id:a}),w(e=>[...e,a]),y({title:"Sevimlilarga qo'shildi",description:"✅ Mahsulot qo‘shildi"})}catch(s){console.error(s),y({title:"Xatolik",description:"❌ Sevimlilarga qo‘shishda muammo"})}})(a,e.id),className:"absolute top-4 right-4",children:b.includes(e.id)?a.jsx(l,{className:"text-2xl text-yellow-400"}):a.jsx(n,{className:"text-2xl text-black"})})]})]},e.id)})})]})]})};export{d as default};
